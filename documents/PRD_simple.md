# PRD - 간소화 버전 (3시간 MVP)
## Shadow Lord Slayer TRPG

---

## 문서 정보

| 항목 | 내용 |
|------|------|
| **문서 제목** | Shadow Lord Slayer TRPG - 간소화 PRD |
| **목표 개발 시간** | 3시간 |
| **핵심 컨셉** | AI GM과 대화하는 텍스트 기반 TRPG 챗봇 |
| **작성일** | 2026년 1월 29일 |

---

## 1. 제품 개요

### 1.1 서비스 소개

AI 게임 마스터(GM)와 대화하며 진행하는 **텍스트 기반 TRPG 웹 챗봇**입니다. 사용자는 별도의 로그인 없이 바로 게임을 시작할 수 있으며, 모든 대화 기록은 Supabase에 자동 저장되어 관리자가 Dashboard에서 직접 확인할 수 있습니다.

### 1.2 핵심 가치

- **즉시 플레이**: 로그인 없이 접속 즉시 게임 시작
- **AI 기반 스토리텔링**: GPT-4o-mini가 GM 역할 수행
- **자동 기록**: 모든 대화가 Supabase에 저장
- **간편한 관리**: Supabase Dashboard에서 데이터 직접 조회

### 1.3 MVP 범위 정의

**포함:**
- 단일 페이지 채팅 인터페이스
- AI GM 시스템 (OpenAI API)
- 대화 기록 자동 저장 (Supabase)
- 세션 기반 대화 관리
- 반응형 UI (데스크톱/모바일)

**제외 (원본 대비):**
- ~~로그인/회원가입~~ → 익명 세션
- ~~캐릭터 선택 UI~~ → 프롬프트로 처리
- ~~스탯/인벤토리 UI~~ → AI가 텍스트로 관리
- ~~스테이지 시스템~~ → 자유로운 대화 진행
- ~~엔딩 시스템~~ → AI가 자연스럽게 종료
- ~~플레이 기록 페이지~~ → Supabase Dashboard 사용

---

## 2. 사용자 시나리오

### 2.1 메인 시나리오: 신규 사용자 플레이

```
1. 사용자가 웹사이트 접속 (예: https://shadow-lord-slayer.vercel.app)
      ↓
2. 페이지 로드 시 자동으로 세션 ID 생성 (UUID)
   - localStorage에 저장하여 브라우저 닫아도 유지
      ↓
3. AI GM이 자동으로 오프닝 메시지 표시
   "그림자 아카데미에 오신 것을 환영합니다. 당신은 마법 학교의
    신입생입니다. 어둠의 군주가 부활하려 하고 있습니다..."
      ↓
4. 사용자가 텍스트 입력창에 행동 입력
   예: "주변을 둘러본다", "마법 지팡이를 찾는다"
      ↓
5. AI GM이 상황을 묘사하고 선택지 또는 다음 상황 제시
      ↓
6. 4-5번 반복하며 스토리 진행
      ↓
7. 모든 대화는 실시간으로 Supabase에 자동 저장
      ↓
8. 관리자는 Supabase Dashboard에서 대화 기록 조회
```

### 2.2 재방문 시나리오

```
1. 같은 브라우저로 재접속
      ↓
2. localStorage에서 기존 세션 ID 확인
      ↓
3. 이전 대화 기록 불러와서 표시 (선택적 구현)
   또는 새 게임으로 시작
```

### 2.3 관리자 시나리오

```
1. Supabase Dashboard 접속 (https://supabase.com/dashboard)
      ↓
2. 프로젝트 선택 → Table Editor → conversations
      ↓
3. 전체 대화 기록 조회, 필터링, 검색
      ↓
4. 세션별 대화 분석, 사용자 행동 패턴 확인
```

---

## 3. 기능 요구사항

### 3.1 채팅 인터페이스

#### 3.1.1 메시지 표시 영역

| 요구사항 | 상세 |
|----------|------|
| **메시지 구분** | GM 메시지(왼쪽, 보라색 배경)와 사용자 메시지(오른쪽, 회색 배경) 시각적 구분 |
| **스크롤** | 새 메시지 추가 시 자동으로 하단 스크롤 |
| **타임스탬프** | 각 메시지에 시간 표시 (선택적, HH:MM 형식) |
| **로딩 상태** | AI 응답 대기 중 "GM이 생각 중..." 표시 또는 타이핑 애니메이션 |
| **마크다운 지원** | GM 메시지의 **굵은 글씨**, *기울임*, 줄바꿈 지원 |

#### 3.1.2 입력 영역

| 요구사항 | 상세 |
|----------|------|
| **입력창** | 하단 고정, 여러 줄 입력 가능한 textarea |
| **전송 버튼** | 입력창 오른쪽에 전송 버튼 |
| **키보드 단축키** | Enter로 전송, Shift+Enter로 줄바꿈 |
| **비활성화** | AI 응답 대기 중 입력창 및 버튼 비활성화 |
| **글자 수 제한** | 최대 500자 (과도한 입력 방지) |
| **빈 입력 방지** | 공백만 있는 경우 전송 불가 |

#### 3.1.3 헤더 영역

| 요구사항 | 상세 |
|----------|------|
| **타이틀** | "Shadow Lord Slayer" 게임 제목 표시 |
| **새 게임 버튼** | 클릭 시 새 세션 시작 (확인 모달 표시) |
| **세션 ID 표시** | 현재 세션 ID 일부 표시 (디버깅용, 선택적) |

### 3.2 AI GM 시스템

#### 3.2.1 시스템 프롬프트

```
당신은 판타지 TRPG 게임 "Shadow Lord Slayer"의 게임 마스터(GM)입니다.

## 세계관
- 배경: 그림자 아카데미 - 마법사를 양성하는 학교
- 목표: 부활하려는 어둠의 군주를 막는 것
- 분위기: 해리포터와 유사한 마법 학교, 다크 판타지 요소

## GM 역할
1. 플레이어의 행동에 맞춰 스토리를 전개하세요
2. 각 응답은 200-300자 내외로 간결하게 작성하세요
3. 상황 묘사 후 2-3개의 선택지를 제시하거나 자유 행동을 유도하세요
4. 전투나 도전 상황에서는 주사위 결과를 묘사하세요 (예: "주사위를 굴려... 15! 성공입니다!")
5. 플레이어의 행동에 따라 긴장감과 보상을 적절히 배분하세요

## 게임 규칙
- 플레이어는 체력(HP), 마나(MP), 용기, 지혜 스탯을 가집니다
- 스탯은 대화 중 자연스럽게 언급하세요 (별도 UI 없음)
- 아이템 획득/사용도 대화로 처리하세요
- 약 10-15턴 내에 클라이맥스에 도달하도록 스토리를 조절하세요

## 주의사항
- 폭력적이거나 선정적인 내용은 피하세요
- 항상 한국어로 응답하세요
- 플레이어가 이상한 행동을 해도 게임 세계관 내에서 처리하세요
```

#### 3.2.2 오프닝 메시지

게임 시작 시 AI가 자동으로 보내는 첫 메시지:

```
🏰 **그림자 아카데미에 오신 것을 환영합니다**

당신은 오늘 마법 학교 '그림자 아카데미'에 입학한 신입생입니다.
고대의 예언에 따르면, 어둠의 군주가 곧 부활할 것이며,
오직 선택받은 자만이 그를 막을 수 있다고 합니다.

갑자기 하늘이 어두워지고, 교장 선생님의 다급한 목소리가 울려 퍼집니다.
"모든 학생은 대강당으로 모이시오! 긴급 상황입니다!"

당신은 어떻게 하시겠습니까?

1. 🏃 서둘러 대강당으로 달려간다
2. 🔍 주변을 살피며 천천히 이동한다
3. 📚 먼저 도서관에 들러 정보를 찾아본다

또는 자유롭게 행동을 입력하세요.
```

#### 3.2.3 API 호출 설정

| 설정 | 값 | 이유 |
|------|-----|------|
| **모델** | gpt-4o-mini | 비용 효율적, 빠른 응답 |
| **max_tokens** | 500 | 적절한 응답 길이 |
| **temperature** | 0.8 | 창의적인 스토리텔링 |
| **presence_penalty** | 0.3 | 반복 방지 |
| **frequency_penalty** | 0.3 | 다양한 표현 유도 |

#### 3.2.4 대화 히스토리 관리

- 최근 20개 메시지만 API에 전송 (토큰 비용 관리)
- 시스템 프롬프트는 항상 포함
- 오래된 메시지는 컨텍스트에서 제외되지만 DB에는 보존

### 3.3 데이터 저장 (Supabase)

#### 3.3.1 저장 시점

| 이벤트 | 저장 내용 |
|--------|-----------|
| **사용자 메시지 전송** | role='user', content=사용자입력 |
| **AI 응답 수신** | role='assistant', content=AI응답 |
| **세션 시작** | 오프닝 메시지 저장 |

#### 3.3.2 에러 처리

- 저장 실패 시 콘솔에 에러 로깅
- 사용자에게는 에러 표시하지 않음 (UX 우선)
- 재시도 로직 없음 (MVP 단순화)

### 3.4 세션 관리

#### 3.4.1 세션 ID 생성

```typescript
// 세션 ID 생성 및 저장 로직
function getOrCreateSessionId(): string {
  const STORAGE_KEY = 'trpg_session_id'
  let sessionId = localStorage.getItem(STORAGE_KEY)

  if (!sessionId) {
    sessionId = crypto.randomUUID() // 예: "550e8400-e29b-41d4-a716-446655440000"
    localStorage.setItem(STORAGE_KEY, sessionId)
  }

  return sessionId
}
```

#### 3.4.2 새 게임 시작

- "새 게임" 버튼 클릭 시 확인 모달 표시
- 확인 시 새 세션 ID 생성
- 기존 세션 ID는 localStorage에서 삭제
- 화면 초기화 후 오프닝 메시지 표시

---

## 4. 비기능 요구사항

### 4.1 성능

| 항목 | 목표 |
|------|------|
| **초기 로딩** | 2초 이내 |
| **AI 응답 시간** | 5초 이내 (네트워크 포함) |
| **메시지 렌더링** | 즉시 (100개 메시지까지 버벅임 없음) |

### 4.2 호환성

| 환경 | 지원 |
|------|------|
| **브라우저** | Chrome, Safari, Firefox, Edge (최신 버전) |
| **디바이스** | 데스크톱, 태블릿, 모바일 |
| **화면 크기** | 최소 320px ~ 최대 무제한 |

### 4.3 보안

| 항목 | 대응 |
|------|------|
| **API 키 보호** | 서버사이드(API Route)에서만 OpenAI 키 사용 |
| **입력 검증** | 사용자 입력 길이 제한 (500자) |
| **XSS 방지** | React의 기본 이스케이핑 활용 |

---

## 5. 기술 스택

### 5.1 프론트엔드

| 기술 | 버전 | 용도 |
|------|------|------|
| **Next.js** | 14.x | React 프레임워크, App Router |
| **React** | 18.x | UI 라이브러리 |
| **TypeScript** | 5.x | 타입 안정성 |
| **Tailwind CSS** | 3.x | 스타일링 |

### 5.2 백엔드/인프라

| 기술 | 용도 |
|------|------|
| **Next.js API Routes** | AI API 호출 서버 |
| **Supabase** | PostgreSQL 데이터베이스 |
| **Vercel** | 호스팅 및 배포 |

### 5.3 외부 서비스

| 서비스 | 용도 | 예상 비용 |
|--------|------|-----------|
| **OpenAI API** | AI GM 응답 생성 | ~$0.01/게임 |
| **Supabase** | 데이터 저장 | 무료 티어 |
| **Vercel** | 호스팅 | 무료 티어 |

---

## 6. 개발 계획

### 6.1 시간 배분 (총 3시간)

| 단계 | 시간 | 작업 내용 |
|------|------|-----------|
| **1. 프로젝트 셋업** | 20분 | Next.js 프로젝트 생성, Tailwind 설정, 폴더 구조 |
| **2. Supabase 설정** | 15분 | 프로젝트 생성, 테이블 생성, 환경변수 설정 |
| **3. 채팅 UI 구현** | 50분 | ChatContainer, MessageList, MessageItem, ChatInput |
| **4. API Route 구현** | 30분 | /api/chat 엔드포인트, OpenAI 연동 |
| **5. Supabase 연동** | 25분 | 클라이언트 설정, 저장/조회 함수 |
| **6. 상태 관리 연결** | 20분 | 세션 관리, 메시지 상태, 로딩 상태 |
| **7. 스타일링** | 15분 | 다크 테마, 반응형 조정 |
| **8. 테스트 및 수정** | 15분 | 전체 플로우 테스트, 버그 수정 |
| **9. 배포** | 10분 | Vercel 배포, 환경변수 설정 |

### 6.2 체크리스트

#### 프로젝트 셋업
- [ ] Next.js 14 프로젝트 생성 (`npx create-next-app@latest`)
- [ ] Tailwind CSS 설정 확인
- [ ] 폴더 구조 생성 (components, lib, app/api)
- [ ] 환경변수 파일 생성 (.env.local)

#### Supabase 설정
- [ ] Supabase 프로젝트 생성
- [ ] conversations 테이블 생성
- [ ] RLS 정책 설정 (익명 접근 허용)
- [ ] API URL, Anon Key 복사

#### 컴포넌트 구현
- [ ] ChatContainer.tsx (전체 레이아웃)
- [ ] MessageList.tsx (메시지 목록)
- [ ] MessageItem.tsx (개별 메시지)
- [ ] ChatInput.tsx (입력창)
- [ ] LoadingIndicator.tsx (로딩 표시)

#### API 구현
- [ ] /api/chat/route.ts 생성
- [ ] OpenAI 클라이언트 설정
- [ ] 시스템 프롬프트 작성
- [ ] 에러 핸들링

#### 연동
- [ ] Supabase 클라이언트 설정 (lib/supabase.ts)
- [ ] 메시지 저장 함수
- [ ] 세션 ID 관리
- [ ] 오프닝 메시지 자동 생성

#### 마무리
- [ ] 반응형 테스트 (모바일)
- [ ] 전체 플로우 테스트
- [ ] Vercel 배포
- [ ] 실제 환경 테스트

---

## 7. 환경 변수

```env
# .env.local

# OpenAI
OPENAI_API_KEY=sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# Supabase
NEXT_PUBLIC_SUPABASE_URL=https://xxxxxxxx.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
```

---

## 8. 예상 결과물

### 8.1 화면 예시

**데스크톱 (1200px 이상)**
```
┌────────────────────────────────────────────────────────┐
│  🏰 Shadow Lord Slayer              [새 게임]          │
├────────────────────────────────────────────────────────┤
│                                                        │
│  ┌──────────────────────────────────────────────────┐ │
│  │ 🎭 GM                                            │ │
│  │ 그림자 아카데미에 오신 것을 환영합니다...         │ │
│  │                                          10:30   │ │
│  └──────────────────────────────────────────────────┘ │
│                                                        │
│                  ┌──────────────────────────────────┐ │
│                  │                              나 👤│ │
│                  │ 대강당으로 달려간다               │ │
│                  │ 10:31                            │ │
│                  └──────────────────────────────────┘ │
│                                                        │
│  ┌──────────────────────────────────────────────────┐ │
│  │ 🎭 GM                                            │ │
│  │ 당신은 복도를 달려 대강당에 도착했습니다...       │ │
│  │                                          10:31   │ │
│  └──────────────────────────────────────────────────┘ │
│                                                        │
│  ⏳ GM이 생각 중...                                    │
│                                                        │
├────────────────────────────────────────────────────────┤
│  [당신의 행동을 입력하세요...                   ] [전송]│
└────────────────────────────────────────────────────────┘
```

### 8.2 Supabase Dashboard 조회 예시

**테이블 뷰:**
| id | session_id | role | content | created_at |
|----|------------|------|---------|------------|
| 1 | abc-123 | assistant | 그림자 아카데미에... | 2026-01-29 10:30:00 |
| 2 | abc-123 | user | 대강당으로 달려간다 | 2026-01-29 10:31:15 |
| 3 | abc-123 | assistant | 당신은 복도를... | 2026-01-29 10:31:18 |

---

## 9. 향후 확장 가능성

MVP 이후 추가할 수 있는 기능들:

| 우선순위 | 기능 | 예상 시간 |
|----------|------|-----------|
| P1 | 이전 대화 불러오기 | 1시간 |
| P1 | 캐릭터 선택 UI | 2시간 |
| P2 | 스탯/인벤토리 사이드바 | 3시간 |
| P2 | 배경 이미지/음악 | 2시간 |
| P3 | 로그인/회원가입 | 4시간 |
| P3 | 플레이 기록 페이지 | 3시간 |

---

**Note**: 이 문서는 3시간 MVP 개발을 위한 최소 사양입니다. 모든 복잡한 기능은 AI 프롬프트로 처리하고, 데이터 관리는 Supabase Dashboard를 활용합니다.
